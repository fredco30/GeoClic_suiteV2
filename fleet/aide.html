<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√©oClic Fleet Manager - Guide Complet</title>
<style>
:root {
  --primary: #1a73e8;
  --primary-dark: #1557b0;
  --primary-light: #e8f0fe;
  --success: #34a853;
  --warning: #f9ab00;
  --danger: #ea4335;
  --text: #202124;
  --text-light: #5f6368;
  --bg: #ffffff;
  --bg-alt: #f8f9fa;
  --border: #dadce0;
  --sidebar-bg: #1e293b;
  --sidebar-text: #e2e8f0;
  --sidebar-active: #3b82f6;
  --code-bg: #1e1e1e;
  --code-text: #d4d4d4;
  --radius: 12px;
  --shadow: 0 1px 3px rgba(0,0,0,.1), 0 1px 2px rgba(0,0,0,.06);
  --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  color: var(--text);
  background: var(--bg-alt);
  line-height: 1.6;
  display: flex;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ */
.sidebar {
  width: 280px;
  background: var(--sidebar-bg);
  color: var(--sidebar-text);
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  overflow-y: auto;
  z-index: 100;
  display: flex;
  flex-direction: column;
  transition: transform .3s;
}

.sidebar-header {
  padding: 24px 20px 16px;
  border-bottom: 1px solid rgba(255,255,255,.1);
}

.sidebar-header h1 {
  font-size: 18px;
  font-weight: 700;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar-header h1 .logo {
  width: 32px;
  height: 32px;
  background: var(--sidebar-active);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

.sidebar-header .version {
  font-size: 12px;
  color: rgba(255,255,255,.5);
  margin-top: 4px;
}

/* Search */
.sidebar-search {
  padding: 12px 16px;
}

.sidebar-search input {
  width: 100%;
  padding: 8px 12px 8px 36px;
  border: 1px solid rgba(255,255,255,.15);
  border-radius: 8px;
  background: rgba(255,255,255,.08);
  color: #fff;
  font-size: 13px;
  outline: none;
  transition: border-color .2s, background .2s;
}

.sidebar-search input::placeholder { color: rgba(255,255,255,.4); }
.sidebar-search input:focus {
  border-color: var(--sidebar-active);
  background: rgba(255,255,255,.12);
}

.sidebar-search-wrap {
  position: relative;
}

.sidebar-search-wrap::before {
  content: 'üîç';
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  opacity: .6;
}

/* Nav */
.sidebar-nav {
  flex: 1;
  padding: 8px 0;
  overflow-y: auto;
}

.nav-section {
  padding: 8px 16px 4px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: rgba(255,255,255,.35);
  font-weight: 600;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 16px 8px 20px;
  color: var(--sidebar-text);
  text-decoration: none;
  font-size: 14px;
  border-left: 3px solid transparent;
  transition: all .15s;
  cursor: pointer;
}

.nav-link:hover {
  background: rgba(255,255,255,.06);
  color: #fff;
}

.nav-link.active {
  background: rgba(59,130,246,.15);
  color: #fff;
  border-left-color: var(--sidebar-active);
  font-weight: 500;
}

.nav-link .icon {
  font-size: 16px;
  width: 22px;
  text-align: center;
  flex-shrink: 0;
}

.nav-link .badge {
  margin-left: auto;
  background: var(--sidebar-active);
  color: #fff;
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 10px;
  font-weight: 600;
}

/* ‚îÄ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ‚îÄ */
.main {
  margin-left: 280px;
  flex: 1;
  min-height: 100vh;
}

.topbar {
  background: #fff;
  border-bottom: 1px solid var(--border);
  padding: 16px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 50;
}

.topbar h2 {
  font-size: 20px;
  font-weight: 600;
}

.topbar-actions {
  display: flex;
  gap: 8px;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--border);
  background: #fff;
  color: var(--text);
  transition: all .15s;
  text-decoration: none;
}

.btn:hover { background: var(--bg-alt); }
.btn-primary { background: var(--primary); color: #fff; border-color: var(--primary); }
.btn-primary:hover { background: var(--primary-dark); }

.content {
  padding: 32px;
  max-width: 960px;
}

/* Sections */
.section {
  display: none;
  animation: fadeIn .3s;
}

.section.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Cards */
.card {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.card-header .card-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.card-header h3 {
  font-size: 17px;
  font-weight: 600;
}

.card-header p {
  font-size: 13px;
  color: var(--text-light);
  margin-top: 2px;
}

/* Steps */
.steps {
  counter-reset: step;
}

.step {
  position: relative;
  padding: 20px 24px 20px 72px;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  box-shadow: var(--shadow);
  transition: box-shadow .2s;
}

.step:hover { box-shadow: var(--shadow-lg); }

.step::before {
  counter-increment: step;
  content: counter(step);
  position: absolute;
  left: 20px;
  top: 20px;
  width: 36px;
  height: 36px;
  background: var(--primary);
  color: #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 15px;
}

.step h4 {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
}

.step p {
  font-size: 14px;
  color: var(--text-light);
  margin-bottom: 8px;
}

/* Code blocks */
.code-block {
  position: relative;
  background: var(--code-bg);
  color: var(--code-text);
  padding: 16px 48px 16px 16px;
  border-radius: 8px;
  font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.7;
  overflow-x: auto;
  margin: 10px 0;
  white-space: pre;
}

.code-block .copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(255,255,255,.1);
  border: none;
  color: rgba(255,255,255,.6);
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  transition: all .2s;
}

.code-block .copy-btn:hover {
  background: rgba(255,255,255,.2);
  color: #fff;
}

.code-block .copy-btn.copied {
  background: var(--success);
  color: #fff;
}

code {
  background: var(--primary-light);
  color: var(--primary-dark);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Cascadia Code', 'Fira Code', monospace;
  font-size: .9em;
}

/* Alert boxes */
.alert {
  padding: 14px 16px 14px 48px;
  border-radius: 8px;
  margin: 12px 0;
  font-size: 14px;
  position: relative;
}

.alert::before {
  position: absolute;
  left: 16px;
  top: 14px;
  font-size: 18px;
}

.alert-info {
  background: #e8f0fe;
  border: 1px solid #c2d7f7;
  color: #174ea6;
}
.alert-info::before { content: '‚ÑπÔ∏è'; }

.alert-warning {
  background: #fef7e0;
  border: 1px solid #f5deb3;
  color: #8a6d3b;
}
.alert-warning::before { content: '‚ö†Ô∏è'; }

.alert-success {
  background: #e6f4ea;
  border: 1px solid #b7e1c4;
  color: #137333;
}
.alert-success::before { content: '‚úÖ'; }

.alert-danger {
  background: #fce8e6;
  border: 1px solid #f5b7b1;
  color: #a93226;
}
.alert-danger::before { content: 'üö´'; }

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
  font-size: 14px;
}

th {
  background: var(--bg-alt);
  font-weight: 600;
  text-align: left;
  padding: 10px 14px;
  border-bottom: 2px solid var(--border);
}

td {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
}

tr:hover td { background: rgba(26,115,232,.03); }

/* Accordion / Collapsible */
.accordion {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin: 12px 0;
}

.accordion-item { border-bottom: 1px solid var(--border); }
.accordion-item:last-child { border-bottom: none; }

.accordion-header {
  padding: 14px 16px;
  background: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: 500;
  font-size: 14px;
  transition: background .15s;
  user-select: none;
}

.accordion-header:hover { background: var(--bg-alt); }

.accordion-header .arrow {
  transition: transform .2s;
  font-size: 12px;
  color: var(--text-light);
}

.accordion-item.open .accordion-header .arrow {
  transform: rotate(90deg);
}

.accordion-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height .3s ease;
}

.accordion-item.open .accordion-body {
  max-height: 2000px;
}

.accordion-content {
  padding: 0 16px 16px;
  font-size: 14px;
  color: var(--text-light);
}

/* Workflow diagram */
.workflow {
  display: flex;
  align-items: center;
  gap: 0;
  margin: 20px 0;
  flex-wrap: wrap;
  justify-content: center;
}

.workflow-step {
  background: #fff;
  border: 2px solid var(--primary);
  border-radius: 12px;
  padding: 16px 20px;
  text-align: center;
  min-width: 160px;
  box-shadow: var(--shadow);
}

.workflow-step .wf-icon { font-size: 28px; margin-bottom: 6px; }
.workflow-step .wf-title { font-weight: 600; font-size: 14px; }
.workflow-step .wf-desc { font-size: 12px; color: var(--text-light); margin-top: 2px; }

.workflow-arrow {
  font-size: 24px;
  color: var(--primary);
  padding: 0 8px;
  flex-shrink: 0;
}

/* Command ref grid */
.cmd-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 12px;
  margin: 16px 0;
}

.cmd-card {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
  transition: all .2s;
  cursor: default;
}

.cmd-card:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px);
}

.cmd-card .cmd-name {
  font-family: monospace;
  font-weight: 700;
  color: var(--primary);
  font-size: 14px;
  margin-bottom: 6px;
}

.cmd-card .cmd-desc {
  font-size: 13px;
  color: var(--text-light);
}

.cmd-card .cmd-badge {
  display: inline-block;
  margin-top: 8px;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
}

.badge-essential { background: #e8f0fe; color: var(--primary); }
.badge-advanced { background: #fef7e0; color: #b45309; }
.badge-debug { background: #f3e8ff; color: #7c3aed; }

/* Responsive */
.mobile-toggle {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 200;
  background: var(--sidebar-bg);
  color: #fff;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  font-size: 20px;
  cursor: pointer;
}

@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; }
  .mobile-toggle { display: flex; align-items: center; justify-content: center; }
  .topbar { padding-left: 60px; }
  .content { padding: 20px; }
}

/* Scroll bar sidebar */
.sidebar::-webkit-scrollbar { width: 6px; }
.sidebar::-webkit-scrollbar-track { background: transparent; }
.sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,.15); border-radius: 3px; }

/* Highlight search */
mark {
  background: #fff3cd;
  padding: 1px 3px;
  border-radius: 2px;
}

/* Print */
@media print {
  .sidebar, .topbar, .mobile-toggle { display: none !important; }
  .main { margin-left: 0 !important; }
  .section { display: block !important; page-break-inside: avoid; }
  .code-block .copy-btn { display: none; }
}
</style>
</head>
<body>

<!-- Mobile toggle -->
<button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h1><span class="logo">üöÄ</span> G√©oClic Fleet</h1>
    <div class="version">Fleet Manager v2.0 - Guide interactif</div>
  </div>

  <div class="sidebar-search">
    <div class="sidebar-search-wrap">
      <input type="text" id="searchInput" placeholder="Rechercher..." oninput="filterSections(this.value)">
    </div>
  </div>

  <nav class="sidebar-nav" id="sidebarNav">
    <div class="nav-section">Accueil</div>
    <a class="nav-link active" data-section="accueil" onclick="showSection('accueil')">
      <span class="icon">üè†</span> Vue d'ensemble
    </a>

    <div class="nav-section">Pr√©requis</div>
    <a class="nav-link" data-section="prerequis" onclick="showSection('prerequis')">
      <span class="icon">üìã</span> Avant de commencer
    </a>
    <a class="nav-link" data-section="vps" onclick="showSection('vps')">
      <span class="icon">üñ•Ô∏è</span> Acheter un VPS
    </a>
    <a class="nav-link" data-section="dns" onclick="showSection('dns')">
      <span class="icon">üåê</span> Configurer le DNS
    </a>
    <a class="nav-link" data-section="ssh" onclick="showSection('ssh')">
      <span class="icon">üîë</span> Configurer SSH
    </a>

    <div class="nav-section">Installation</div>
    <a class="nav-link" data-section="provision" onclick="showSection('provision')">
      <span class="icon">üì¶</span> Provisionner un serveur
      <span class="badge">Essentiel</span>
    </a>
    <a class="nav-link" data-section="init" onclick="showSection('init')">
      <span class="icon">üóÑÔ∏è</span> Initialiser la base
      <span class="badge">Essentiel</span>
    </a>

    <div class="nav-section">Gestion quotidienne</div>
    <a class="nav-link" data-section="update" onclick="showSection('update')">
      <span class="icon">üîÑ</span> Mettre √† jour
    </a>
    <a class="nav-link" data-section="status" onclick="showSection('status')">
      <span class="icon">üìä</span> Voir l'√©tat
    </a>
    <a class="nav-link" data-section="backup" onclick="showSection('backup')">
      <span class="icon">üíæ</span> Sauvegardes
    </a>
    <a class="nav-link" data-section="logs" onclick="showSection('logs')">
      <span class="icon">üìù</span> Consulter les logs
    </a>

    <div class="nav-section">Gestion serveurs</div>
    <a class="nav-link" data-section="list" onclick="showSection('list')">
      <span class="icon">üìÉ</span> Lister / Ajouter / Retirer
    </a>
    <a class="nav-link" data-section="ssh-cmd" onclick="showSection('ssh-cmd')">
      <span class="icon">üíª</span> Acc√®s SSH distant
    </a>

    <div class="nav-section">R√©f√©rence</div>
    <a class="nav-link" data-section="reference" onclick="showSection('reference')">
      <span class="icon">üìñ</span> Toutes les commandes
    </a>
    <a class="nav-link" data-section="faq" onclick="showSection('faq')">
      <span class="icon">‚ùì</span> FAQ / D√©pannage
    </a>
    <a class="nav-link" data-section="glossaire" onclick="showSection('glossaire')">
      <span class="icon">üìö</span> Glossaire
    </a>
  </nav>
</aside>

<!-- Main content -->
<div class="main">
  <div class="topbar">
    <h2 id="topbarTitle">Vue d'ensemble</h2>
    <div class="topbar-actions">
      <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimer</button>
      <button class="btn btn-primary" onclick="showSection('provision')">üöÄ Nouveau client</button>
    </div>
  </div>

  <div class="content">

    <!-- ‚ïê‚ïê‚ïê ACCUEIL ‚ïê‚ïê‚ïê -->
    <div class="section active" id="sec-accueil">
      <div class="card" style="border-left: 4px solid var(--primary);">
        <h3 style="font-size: 22px; margin-bottom: 12px;">Bienvenue dans G√©oClic Fleet Manager</h3>
        <p style="font-size: 15px; color: var(--text-light); margin-bottom: 20px;">
          Fleet Manager vous permet de d√©ployer et g√©rer G√©oClic Suite sur plusieurs serveurs clients,
          le tout depuis votre serveur principal. Aucune connaissance Linux avanc√©e n'est requise :
          suivez simplement ce guide √©tape par √©tape.
        </p>
      </div>

      <h3 style="margin: 24px 0 16px;">Comment √ßa marche ?</h3>
      <div class="workflow">
        <div class="workflow-step">
          <div class="wf-icon">üñ•Ô∏è</div>
          <div class="wf-title">1. Acheter un VPS</div>
          <div class="wf-desc">Serveur chez OVH, Scaleway...</div>
        </div>
        <div class="workflow-arrow">‚Üí</div>
        <div class="workflow-step">
          <div class="wf-icon">üåê</div>
          <div class="wf-title">2. Configurer DNS</div>
          <div class="wf-desc">nom-du-client.geoclic.fr</div>
        </div>
        <div class="workflow-arrow">‚Üí</div>
        <div class="workflow-step">
          <div class="wf-icon">üì¶</div>
          <div class="wf-title">3. Provisionner</div>
          <div class="wf-desc">Docker, code, SSL, .env</div>
        </div>
        <div class="workflow-arrow">‚Üí</div>
        <div class="workflow-step">
          <div class="wf-icon">üóÑÔ∏è</div>
          <div class="wf-title">4. Initialiser DB</div>
          <div class="wf-desc">25 migrations + admin</div>
        </div>
        <div class="workflow-arrow">‚Üí</div>
        <div class="workflow-step" style="border-color: var(--success);">
          <div class="wf-icon">‚úÖ</div>
          <div class="wf-title">5. C'est pr√™t !</div>
          <div class="wf-desc">Le client se connecte</div>
        </div>
      </div>

      <h3 style="margin: 28px 0 16px;">Commandes essentielles</h3>
      <div class="cmd-grid">
        <div class="cmd-card" onclick="showSection('provision')">
          <div class="cmd-name">provision</div>
          <div class="cmd-desc">Installer G√©oClic sur un nouveau serveur vierge</div>
          <span class="cmd-badge badge-essential">Essentiel</span>
        </div>
        <div class="cmd-card" onclick="showSection('init')">
          <div class="cmd-name">init</div>
          <div class="cmd-desc">Cr√©er les tables et le compte administrateur</div>
          <span class="cmd-badge badge-essential">Essentiel</span>
        </div>
        <div class="cmd-card" onclick="showSection('update')">
          <div class="cmd-name">update</div>
          <div class="cmd-desc">Mettre √† jour un ou tous les serveurs clients</div>
          <span class="cmd-badge badge-essential">Essentiel</span>
        </div>
        <div class="cmd-card" onclick="showSection('status')">
          <div class="cmd-name">status</div>
          <div class="cmd-desc">V√©rifier que tous les serveurs fonctionnent</div>
          <span class="cmd-badge badge-advanced">Gestion</span>
        </div>
        <div class="cmd-card" onclick="showSection('backup')">
          <div class="cmd-name">backup</div>
          <div class="cmd-desc">D√©clencher une sauvegarde de la base de donn√©es</div>
          <span class="cmd-badge badge-advanced">Gestion</span>
        </div>
        <div class="cmd-card" onclick="showSection('logs')">
          <div class="cmd-name">logs</div>
          <div class="cmd-desc">Voir les logs d'un service Docker distant</div>
          <span class="cmd-badge badge-debug">Debug</span>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PREREQUIS ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-prerequis">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: var(--primary-light); color: var(--primary);">üìã</div>
          <div>
            <h3>Ce dont vous avez besoin avant de commencer</h3>
            <p>Checklist compl√®te des pr√©requis pour d√©ployer un nouveau client</p>
          </div>
        </div>

        <table>
          <thead>
            <tr><th>√âl√©ment</th><th>D√©tail</th><th>Co√ªt</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Un VPS (serveur)</strong></td>
              <td>Ubuntu 22.04 ou 24.04, minimum 2 Go RAM, 20 Go disque</td>
              <td>~5-10‚Ç¨/mois</td>
            </tr>
            <tr>
              <td><strong>Un nom de domaine</strong></td>
              <td>Sous-domaine de geoclic.fr ou domaine du client</td>
              <td>Inclus ou ~10‚Ç¨/an</td>
            </tr>
            <tr>
              <td><strong>Acc√®s SSH au serveur</strong></td>
              <td>L'IP du VPS + la cl√© SSH Fleet configur√©e</td>
              <td>Gratuit</td>
            </tr>
            <tr>
              <td><strong>Un email admin</strong></td>
              <td>Pour les certificats SSL et le compte super admin</td>
              <td>Gratuit</td>
            </tr>
          </tbody>
        </table>

        <div class="alert alert-info">
          <strong>Rappel :</strong> Toutes les commandes Fleet s'ex√©cutent depuis votre serveur principal
          (geoclic.fr). Vous n'avez jamais besoin de vous connecter manuellement au serveur du client.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê VPS ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-vps">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e8f0fe; color: var(--primary);">üñ•Ô∏è</div>
          <div>
            <h3>Acheter un VPS pour un nouveau client</h3>
            <p>Guide pas-√†-pas pour commander un serveur</p>
          </div>
        </div>

        <p>Un <strong>VPS</strong> (Virtual Private Server) est un serveur virtuel chez un h√©bergeur. C'est comme un ordinateur qui tourne 24h/24 sur internet.</p>

        <h4 style="margin: 20px 0 12px;">Fournisseurs recommand√©s</h4>
        <table>
          <thead>
            <tr><th>Fournisseur</th><th>Offre recommand√©e</th><th>Prix</th><th>Avantage</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>OVH</strong></td>
              <td>VPS Starter (2 Go RAM, 40 Go SSD)</td>
              <td>~6‚Ç¨/mois</td>
              <td>H√©bergeur fran√ßais, RGPD, support FR</td>
            </tr>
            <tr>
              <td><strong>Scaleway</strong></td>
              <td>DEV1-S (2 Go RAM, 20 Go SSD)</td>
              <td>~5‚Ç¨/mois</td>
              <td>Interface moderne, Paris datacenter</td>
            </tr>
            <tr>
              <td><strong>Hetzner</strong></td>
              <td>CX22 (4 Go RAM, 40 Go SSD)</td>
              <td>~4‚Ç¨/mois</td>
              <td>Tr√®s bon rapport qualit√©/prix</td>
            </tr>
          </tbody>
        </table>

        <div class="steps">
          <div class="step">
            <h4>Aller sur le site du fournisseur</h4>
            <p>Exemple OVH : allez sur <code>ovhcloud.com</code>, section "VPS", cliquez "Commander".</p>
          </div>
          <div class="step">
            <h4>Choisir le syst√®me d'exploitation</h4>
            <p>S√©lectionnez <strong>Ubuntu 22.04</strong> ou <strong>Ubuntu 24.04</strong> (jamais Windows, jamais CentOS).</p>
          </div>
          <div class="step">
            <h4>Choisir l'offre</h4>
            <p>Minimum <strong>2 Go de RAM</strong> et <strong>20 Go de disque</strong>. Pour une grosse commune, pr√©f√©rez 4 Go.</p>
          </div>
          <div class="step">
            <h4>Payer et r√©cup√©rer les infos</h4>
            <p>Apr√®s le paiement, vous recevrez par email :</p>
            <ul style="margin: 8px 0 0 20px;">
              <li><strong>L'adresse IP</strong> du serveur (ex: <code>51.210.42.100</code>)</li>
              <li><strong>Le mot de passe root</strong> (on ne l'utilisera qu'une fois)</li>
            </ul>
          </div>
        </div>

        <div class="alert alert-success">
          <strong>Notez bien l'adresse IP</strong> ‚Äî vous en aurez besoin pour toutes les √©tapes suivantes.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê DNS ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-dns">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e6f4ea; color: var(--success);">üåê</div>
          <div>
            <h3>Configurer le DNS</h3>
            <p>Relier un nom de domaine √† l'adresse IP du serveur</p>
          </div>
        </div>

        <p>Le <strong>DNS</strong> est l'annuaire d'internet. Il traduit un nom lisible (ex: <code>lyon.geoclic.fr</code>) en adresse IP (ex: <code>51.210.42.100</code>).</p>

        <div class="steps">
          <div class="step">
            <h4>Aller dans votre gestionnaire DNS</h4>
            <p>Connectez-vous √† l'interface o√π vous g√©rez le domaine <code>geoclic.fr</code> (OVH, Cloudflare, etc.).</p>
          </div>
          <div class="step">
            <h4>Ajouter un enregistrement DNS de type A</h4>
            <p>Cr√©ez un nouvel enregistrement avec ces valeurs :</p>
            <table>
              <tr><th>Champ</th><th>Valeur</th></tr>
              <tr><td>Type</td><td><code>A</code></td></tr>
              <tr><td>Nom / Sous-domaine</td><td><code>lyon</code> (pour lyon.geoclic.fr)</td></tr>
              <tr><td>Adresse IP</td><td><code>51.210.42.100</code> (IP du VPS)</td></tr>
              <tr><td>TTL</td><td><code>3600</code> (ou laisser par d√©faut)</td></tr>
            </table>
          </div>
          <div class="step">
            <h4>Attendre la propagation</h4>
            <p>Le DNS met entre <strong>5 minutes et 24 heures</strong> √† se propager. En g√©n√©ral, c'est actif en moins d'une heure.</p>
            <p>Pour v√©rifier :</p>
            <div class="code-block">ping lyon.geoclic.fr<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
            <p>Si vous voyez l'IP du VPS dans la r√©ponse, c'est bon !</p>
          </div>
        </div>

        <div class="alert alert-warning">
          <strong>Important :</strong> Le DNS doit √™tre configur√© AVANT l'√©tape "provision" car le certificat SSL (HTTPS) a besoin que le domaine pointe d√©j√† vers le serveur.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê SSH ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-ssh">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #fef7e0; color: #b45309;">üîë</div>
          <div>
            <h3>Configurer la cl√© SSH Fleet</h3>
            <p>Permettre √† Fleet de se connecter aux serveurs clients sans mot de passe</p>
          </div>
        </div>

        <p><strong>SSH</strong> est un moyen s√©curis√© de se connecter √† un serveur distant. La <strong>cl√© SSH</strong> remplace le mot de passe : c'est plus s√©curis√© et Fleet en a besoin.</p>

        <h4 style="margin: 16px 0 8px;">√âtape 1 : G√©n√©rer la cl√© Fleet (une seule fois)</h4>
        <p>Sur votre serveur principal (geoclic.fr) :</p>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh ssh-key generate<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
        <p>Cela cr√©e deux fichiers :</p>
        <ul style="margin: 8px 0 0 20px;">
          <li><code>~/.ssh/geoclic_fleet_key</code> ‚Äî la cl√© priv√©e (ne jamais partager !)</li>
          <li><code>~/.ssh/geoclic_fleet_key.pub</code> ‚Äî la cl√© publique (√† copier sur les VPS)</li>
        </ul>

        <h4 style="margin: 20px 0 8px;">√âtape 2 : Copier la cl√© sur le nouveau VPS</h4>
        <p>D'abord, affichez la cl√© publique :</p>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh ssh-key show<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
        <p>Copiez le texte affich√©. Puis connectez-vous au VPS avec le mot de passe root re√ßu par email :</p>
        <div class="code-block">ssh root@51.210.42.100
# Entrez le mot de passe root

# Cr√©er l'utilisateur ubuntu (si pas d√©j√† fait)
adduser ubuntu --disabled-password --gecos ""
usermod -aG sudo docker ubuntu
echo "ubuntu ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/ubuntu

# Autoriser la cl√© Fleet
mkdir -p /home/ubuntu/.ssh
echo "COLLEZ_LA_CLE_PUBLIQUE_ICI" >> /home/ubuntu/.ssh/authorized_keys
chown -R ubuntu:ubuntu /home/ubuntu/.ssh
chmod 700 /home/ubuntu/.ssh
chmod 600 /home/ubuntu/.ssh/authorized_keys

# Quitter
exit<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">√âtape 3 : V√©rifier que √ßa marche</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh test-ssh 51.210.42.100 ubuntu<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
        <p>Si vous voyez <code>{"status":"ok"}</code>, la connexion SSH fonctionne !</p>

        <div class="alert alert-danger">
          <strong>Ne partagez JAMAIS la cl√© priv√©e</strong> (<code>geoclic_fleet_key</code>). Seule la cl√© publique (<code>.pub</code>) se copie sur les serveurs.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PROVISION ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-provision">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e8f0fe; color: var(--primary);">üì¶</div>
          <div>
            <h3>Provisionner un nouveau serveur</h3>
            <p>Installe Docker, copie le code, configure SSL et d√©marre les conteneurs</p>
          </div>
        </div>

        <div class="alert alert-info">
          <strong>Pr√©requis :</strong> Le VPS est achet√©, le DNS est configur√©, la cl√© SSH est install√©e.
        </div>

        <h4 style="margin: 16px 0 8px;">La commande</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh provision \
  --name ville-lyon \
  --domain lyon.geoclic.fr \
  --ip 51.210.42.100 \
  --email admin@lyon.fr<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 12px;">Param√®tres</h4>
        <table>
          <thead>
            <tr><th>Param√®tre</th><th>Obligatoire</th><th>Description</th><th>Exemple</th></tr>
          </thead>
          <tbody>
            <tr><td><code>--name</code></td><td>Oui</td><td>Nom unique du client (sans espaces)</td><td><code>ville-lyon</code></td></tr>
            <tr><td><code>--domain</code></td><td>Oui</td><td>Nom de domaine du client</td><td><code>lyon.geoclic.fr</code></td></tr>
            <tr><td><code>--ip</code></td><td>Oui</td><td>Adresse IP du VPS</td><td><code>51.210.42.100</code></td></tr>
            <tr><td><code>--email</code></td><td>Oui</td><td>Email pour SSL (Let's Encrypt)</td><td><code>admin@lyon.fr</code></td></tr>
            <tr><td><code>--ssh-user</code></td><td>Non</td><td>Utilisateur SSH (d√©faut: ubuntu)</td><td><code>ubuntu</code></td></tr>
            <tr><td><code>--ssh-port</code></td><td>Non</td><td>Port SSH (d√©faut: 22)</td><td><code>22</code></td></tr>
          </tbody>
        </table>

        <h4 style="margin: 20px 0 12px;">Ce que fait la commande (7 √©tapes automatiques)</h4>
        <div class="steps">
          <div class="step">
            <h4>Test connexion SSH</h4>
            <p>V√©rifie qu'on peut se connecter au serveur</p>
          </div>
          <div class="step">
            <h4>Installation des pr√©requis</h4>
            <p>Met √† jour Ubuntu, installe Docker et docker-compose</p>
          </div>
          <div class="step">
            <h4>Copie du code G√©oClic</h4>
            <p>Envoie tout le code de votre serveur vers le nouveau VPS via rsync</p>
          </div>
          <div class="step">
            <h4>Configuration environnement</h4>
            <p>G√©n√®re le fichier <code>.env</code> avec des mots de passe s√©curis√©s uniques</p>
          </div>
          <div class="step">
            <h4>Certificat SSL</h4>
            <p>Obtient un certificat HTTPS gratuit via Let's Encrypt</p>
          </div>
          <div class="step">
            <h4>Construction Docker</h4>
            <p>Build tous les conteneurs et les d√©marre</p>
          </div>
          <div class="step">
            <h4>Configuration finale</h4>
            <p>Configure les sauvegardes automatiques, le monitoring, et le red√©marrage auto</p>
          </div>
        </div>

        <div class="alert alert-warning">
          <strong>Dur√©e :</strong> Le provisionnement prend environ <strong>10 √† 20 minutes</strong> selon la vitesse du VPS. Ne fermez pas le terminal pendant l'ex√©cution.
        </div>

        <div class="alert alert-success">
          <strong>Apr√®s le provisionnement :</strong> L'√©tape suivante est d'initialiser la base de donn√©es avec la commande <code>init</code>.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-init">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e6f4ea; color: var(--success);">üóÑÔ∏è</div>
          <div>
            <h3>Initialiser la base de donn√©es</h3>
            <p>Applique les 25 migrations SQL et cr√©e le compte super administrateur</p>
          </div>
        </div>

        <div class="alert alert-info">
          <strong>Pr√©requis :</strong> Le serveur doit √™tre provisionn√© (commande <code>provision</code> termin√©e avec succ√®s).
        </div>

        <h4 style="margin: 16px 0 8px;">La commande</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh init \
  --client ville-lyon \
  --email admin@lyon.fr \
  --password MotDePasse2026! \
  --collectivite "Mairie de Lyon"<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 12px;">Param√®tres</h4>
        <table>
          <thead>
            <tr><th>Param√®tre</th><th>Obligatoire</th><th>Description</th><th>Exemple</th></tr>
          </thead>
          <tbody>
            <tr><td><code>--client</code></td><td>Oui</td><td>Nom du serveur (celui donn√© lors du provision)</td><td><code>ville-lyon</code></td></tr>
            <tr><td><code>--email</code></td><td>Oui</td><td>Email du super administrateur</td><td><code>admin@lyon.fr</code></td></tr>
            <tr><td><code>--password</code></td><td>Oui</td><td>Mot de passe du super admin</td><td><code>MotDePasse2026!</code></td></tr>
            <tr><td><code>--collectivite</code></td><td>Non</td><td>Nom de la collectivit√© (d√©faut: "Ma Collectivit√©")</td><td><code>"Mairie de Lyon"</code></td></tr>
            <tr><td><code>--with-demo</code></td><td>Non</td><td>Charger aussi les donn√©es de d√©monstration</td><td>(pas de valeur)</td></tr>
          </tbody>
        </table>

        <h4 style="margin: 20px 0 12px;">Ce que fait la commande</h4>
        <div class="steps">
          <div class="step">
            <h4>V√©rifie la connexion √† la base de donn√©es</h4>
            <p>S'assure que PostgreSQL et PostGIS fonctionnent dans le conteneur Docker</p>
          </div>
          <div class="step">
            <h4>Applique les 25 migrations SQL</h4>
            <p>Cr√©e toutes les tables, fonctions, triggers et vues. C'est ce qui donne au client TOUTES les fonctionnalit√©s (demandes, services, zones, tchat, notifications...)</p>
          </div>
          <div class="step">
            <h4>Cr√©e le compte super administrateur</h4>
            <p>G√©n√®re un hash bcrypt du mot de passe et ins√®re le compte dans la table <code>geoclic_users</code> avec tous les droits</p>
          </div>
          <div class="step">
            <h4>Configure le branding initial</h4>
            <p>Enregistre le nom de la collectivit√© et les couleurs par d√©faut dans <code>system_settings</code></p>
          </div>
        </div>

        <h4 style="margin: 20px 0 12px;">Avec donn√©es de d√©monstration</h4>
        <p>Ajoutez <code>--with-demo</code> pour charger des donn√©es fictives r√©alistes :</p>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh init \
  --client demo-serveur \
  --email admin@demo.geoclic.fr \
  --password demo2026! \
  --collectivite "Ville de Montpellier" \
  --with-demo<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <p style="margin-top: 8px;">Les donn√©es de d√©mo incluent :</p>
        <ul style="margin: 4px 0 0 20px;">
          <li>3 comptes utilisateurs (admin, voirie, espaces verts)</li>
          <li>4 services municipaux</li>
          <li>15 cat√©gories de signalement</li>
          <li>12 signalements fictifs autour de Montpellier</li>
        </ul>

        <div class="alert alert-success">
          <strong>C'est termin√© !</strong> Le client peut maintenant se connecter sur <code>https://lyon.geoclic.fr/admin/</code> avec son email et mot de passe. Le wizard d'onboarding le guidera pour la configuration.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê UPDATE ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-update">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e8f0fe; color: var(--primary);">üîÑ</div>
          <div>
            <h3>Mettre √† jour les serveurs clients</h3>
            <p>Envoie les derni√®res modifications de code et reconstruit les conteneurs</p>
          </div>
        </div>

        <h4 style="margin: 16px 0 8px;">Mettre √† jour un seul client</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh update --client ville-lyon<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Mettre √† jour TOUS les clients d'un coup</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh update --all<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Mettre √† jour avec une migration SQL</h4>
        <p>Si une nouvelle fonctionnalit√© n√©cessite un changement de base de donn√©es :</p>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh update \
  --client ville-lyon \
  --migration 025_nouvelle_feature.sql<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Mettre √† jour uniquement certains services</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh update \
  --client ville-lyon \
  --services "api portail demandes"<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 12px;">Ce que fait la commande (4-5 √©tapes)</h4>
        <div class="steps">
          <div class="step">
            <h4>Sauvegarde automatique</h4>
            <p>Fait un backup de la base de donn√©es AVANT toute modification (s√©curit√©)</p>
          </div>
          <div class="step">
            <h4>Synchronisation du code</h4>
            <p>Envoie les fichiers modifi√©s via rsync (seuls les fichiers chang√©s sont transf√©r√©s)</p>
          </div>
          <div class="step">
            <h4>Migration SQL (si demand√©)</h4>
            <p>Applique le fichier SQL sur la base de donn√©es du client</p>
          </div>
          <div class="step">
            <h4>Reconstruction Docker</h4>
            <p>Rebuild et red√©marre les conteneurs avec le nouveau code</p>
          </div>
          <div class="step">
            <h4>V√©rification de sant√©</h4>
            <p>Teste que l'API r√©pond correctement (HTTP 200)</p>
          </div>
        </div>

        <div class="alert alert-warning">
          <strong>Important :</strong> La mise √† jour provoque une courte interruption de service (2-5 minutes) pendant le rebuild Docker. Pr√©f√©rez les mises √† jour en dehors des heures de bureau.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê STATUS ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-status">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e6f4ea; color: var(--success);">üìä</div>
          <div>
            <h3>V√©rifier l'√©tat des serveurs</h3>
            <p>Voir si tous les serveurs clients sont en ligne et fonctionnent</p>
          </div>
        </div>

        <h4 style="margin: 16px 0 8px;">√âtat de tous les serveurs</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh status<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
        <p>R√©sultat :</p>
        <div class="code-block" style="color: #fff;">üü¢ ville-lyon (lyon.geoclic.fr) - HTTP 200 - SSL: Mar 15 2027 - SSH: true
üü¢ ville-nice (nice.geoclic.fr) - HTTP 200 - SSL: Jun 20 2027 - SSH: true
üî¥ ville-test (test.geoclic.fr) - HTTP 000 - SSL:  - SSH: false<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 12px;">Comprendre les r√©sultats</h4>
        <table>
          <tr><th>Indicateur</th><th>Signification</th></tr>
          <tr><td>üü¢ HTTP 200</td><td>Le serveur fonctionne parfaitement</td></tr>
          <tr><td>üî¥ HTTP 000</td><td>Le serveur ne r√©pond pas (√©teint ou DNS pas configur√©)</td></tr>
          <tr><td>üî¥ HTTP 502</td><td>Nginx fonctionne mais l'API est plant√©e</td></tr>
          <tr><td>SSL: date</td><td>Date d'expiration du certificat HTTPS</td></tr>
          <tr><td>SSH: true/false</td><td>Connexion SSH possible ou non</td></tr>
        </table>

        <h4 style="margin: 20px 0 8px;">√âtat d√©taill√© d'un seul client (JSON)</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh status --client ville-lyon<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê BACKUP ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-backup">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #fef7e0; color: #b45309;">üíæ</div>
          <div>
            <h3>Sauvegardes</h3>
            <p>D√©clencher une sauvegarde de la base de donn√©es d'un client</p>
          </div>
        </div>

        <div class="alert alert-info">
          <strong>Automatique :</strong> Les sauvegardes sont d√©j√† configur√©es automatiquement tous les jours √† 2h du matin sur chaque serveur. Cette commande permet de d√©clencher une sauvegarde suppl√©mentaire manuellement.
        </div>

        <h4 style="margin: 16px 0 8px;">Sauvegarder un client</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh backup --client ville-lyon<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Sauvegarder tous les clients</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh backup --all<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <div class="alert alert-warning">
          <strong>Conseil :</strong> Faites toujours un backup manuel <strong>avant</strong> une mise √† jour importante. La commande <code>update</code> le fait automatiquement, mais mieux vaut √™tre prudent.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê LOGS ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-logs">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #f3e8ff; color: #7c3aed;">üìù</div>
          <div>
            <h3>Consulter les logs</h3>
            <p>Voir ce qu'il se passe dans les conteneurs Docker d'un client</p>
          </div>
        </div>

        <h4 style="margin: 16px 0 8px;">Voir les logs de l'API</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh logs ville-lyon<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Voir les logs d'un service sp√©cifique</h4>
        <div class="code-block"># Logs du portail citoyen
sudo /opt/geoclic/fleet/geoclic-fleet.sh logs ville-lyon --service portail

# Logs de nginx (proxy web)
sudo /opt/geoclic/fleet/geoclic-fleet.sh logs ville-lyon --service nginx

# Logs de la base de donn√©es
sudo /opt/geoclic/fleet/geoclic-fleet.sh logs ville-lyon --service db<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Afficher plus de lignes</h4>
        <div class="code-block"># Afficher les 200 derni√®res lignes
sudo /opt/geoclic/fleet/geoclic-fleet.sh logs ville-lyon --lines 200<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 12px;">Services disponibles</h4>
        <table>
          <tr><th>Service</th><th>Conteneur</th><th>Description</th></tr>
          <tr><td><code>api</code></td><td>geoclic_api</td><td>API FastAPI (erreurs 500, requ√™tes)</td></tr>
          <tr><td><code>db</code></td><td>geoclic_db</td><td>PostgreSQL (erreurs SQL)</td></tr>
          <tr><td><code>nginx</code></td><td>geoclic_nginx</td><td>Proxy web (erreurs 502, 404)</td></tr>
          <tr><td><code>portail</code></td><td>geoclic_portail</td><td>Portail citoyen</td></tr>
          <tr><td><code>demandes</code></td><td>geoclic_demandes</td><td>Back-office demandes</td></tr>
          <tr><td><code>admin</code></td><td>geoclic_admin</td><td>G√©oClic Data (admin)</td></tr>
          <tr><td><code>sig</code></td><td>geoclic_sig</td><td>SIG Web cartographie</td></tr>
          <tr><td><code>services</code></td><td>geoclic_services</td><td>Services terrain (desktop)</td></tr>
          <tr><td><code>terrain</code></td><td>geoclic_terrain</td><td>PWA terrain (mobile)</td></tr>
        </table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê LIST / ADD / REMOVE ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-list">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e8f0fe; color: var(--primary);">üìÉ</div>
          <div>
            <h3>G√©rer le registre des serveurs</h3>
            <p>Lister, ajouter ou retirer des serveurs du registre Fleet</p>
          </div>
        </div>

        <h4 style="margin: 16px 0 8px;">Lister tous les serveurs</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh list<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Ajouter un serveur manuellement</h4>
        <p>Utile si vous avez un serveur d√©j√† existant que vous voulez g√©rer avec Fleet :</p>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh add \
  --name ville-nice \
  --domain nice.geoclic.fr \
  --ip 51.210.99.200<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <h4 style="margin: 20px 0 8px;">Retirer un serveur du registre</h4>
        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh remove --name ville-test<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <div class="alert alert-info">
          <strong>Note :</strong> Retirer un serveur du registre ne supprime rien sur le serveur distant. Cela supprime simplement l'entr√©e dans le fichier <code>clients.conf</code>.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê SSH CMD ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-ssh-cmd">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: var(--code-bg); color: var(--code-text);">üíª</div>
          <div>
            <h3>Acc√®s SSH direct</h3>
            <p>Se connecter directement au terminal d'un serveur client</p>
          </div>
        </div>

        <div class="code-block">sudo /opt/geoclic/fleet/geoclic-fleet.sh ssh ville-lyon<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <p style="margin-top: 12px;">Cela vous connecte directement au serveur du client. Vous pouvez alors ex√©cuter des commandes comme :</p>

        <div class="code-block"># Voir l'√©tat des conteneurs
cd /opt/geoclic/deploy && sudo docker-compose ps

# Red√©marrer un service
sudo docker-compose restart api

# Acc√©der √† la base de donn√©es
sudo docker exec -it geoclic_db psql -U geoclic -d geoclic_db

# Quitter le serveur
exit<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>

        <div class="alert alert-warning">
          <strong>Attention :</strong> Sur le serveur client, toutes les commandes doivent √™tre pr√©fix√©es par <code>sudo</code>. Pour quitter, tapez <code>exit</code>.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê REFERENCE ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-reference">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #e8f0fe; color: var(--primary);">üìñ</div>
          <div>
            <h3>R√©f√©rence compl√®te des commandes</h3>
            <p>Toutes les commandes Fleet avec leurs options</p>
          </div>
        </div>

        <div class="cmd-grid">
          <div class="cmd-card">
            <div class="cmd-name">provision</div>
            <div class="cmd-desc">Installe G√©oClic sur un nouveau VPS</div>
            <span class="cmd-badge badge-essential">Essentiel</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">init</div>
            <div class="cmd-desc">Initialise la DB (migrations + admin)</div>
            <span class="cmd-badge badge-essential">Essentiel</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">update</div>
            <div class="cmd-desc">Met √† jour un ou tous les serveurs</div>
            <span class="cmd-badge badge-essential">Essentiel</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">status</div>
            <div class="cmd-desc">V√©rifie l'√©tat de sant√© des serveurs</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">list</div>
            <div class="cmd-desc">Liste les serveurs enregistr√©s</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">add</div>
            <div class="cmd-desc">Ajoute un serveur au registre</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">remove</div>
            <div class="cmd-desc">Retire un serveur du registre</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">ssh</div>
            <div class="cmd-desc">Connexion SSH directe √† un serveur</div>
            <span class="cmd-badge badge-debug">Debug</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">logs</div>
            <div class="cmd-desc">Consulte les logs Docker d'un serveur</div>
            <span class="cmd-badge badge-debug">Debug</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">backup</div>
            <div class="cmd-desc">D√©clenche une sauvegarde manuelle</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">ssh-key</div>
            <div class="cmd-desc">G√©n√®re ou affiche la cl√© SSH Fleet</div>
            <span class="cmd-badge badge-advanced">Gestion</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">test-ssh</div>
            <div class="cmd-desc">Teste la connexion SSH vers une IP</div>
            <span class="cmd-badge badge-debug">Debug</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">task-status</div>
            <div class="cmd-desc">V√©rifie l'avancement d'une t√¢che</div>
            <span class="cmd-badge badge-debug">Debug</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">task-log</div>
            <div class="cmd-desc">Consulte le log d'une t√¢che pass√©e</div>
            <span class="cmd-badge badge-debug">Debug</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">aide</div>
            <div class="cmd-desc">Ouvre cette page d'aide interactive</div>
            <span class="cmd-badge badge-essential">Essentiel</span>
          </div>
          <div class="cmd-card">
            <div class="cmd-name">help</div>
            <div class="cmd-desc">Aide rapide dans le terminal</div>
            <span class="cmd-badge badge-essential">Essentiel</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê FAQ ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-faq">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #fef7e0; color: #b45309;">‚ùì</div>
          <div>
            <h3>FAQ et D√©pannage</h3>
            <p>Solutions aux probl√®mes les plus fr√©quents</p>
          </div>
        </div>

        <div class="accordion">
          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Le provision √©choue √† l'√©tape SSH
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> La cl√© SSH Fleet n'est pas autoris√©e sur le VPS.</p>
                <p><strong>Solution :</strong></p>
                <ol style="margin: 8px 0 0 20px;">
                  <li>V√©rifiez que la cl√© est g√©n√©r√©e : <code>geoclic-fleet.sh ssh-key show</code></li>
                  <li>Connectez-vous au VPS manuellement et ajoutez la cl√© dans <code>/home/ubuntu/.ssh/authorized_keys</code></li>
                  <li>Testez : <code>geoclic-fleet.sh test-ssh IP ubuntu</code></li>
                </ol>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Le certificat SSL √©choue (erreur certbot)
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> Le DNS ne pointe pas encore vers le bon serveur.</p>
                <p><strong>Solution :</strong></p>
                <ol style="margin: 8px 0 0 20px;">
                  <li>V√©rifiez avec <code>ping votre-domaine.geoclic.fr</code></li>
                  <li>Si l'IP ne correspond pas, attendez la propagation DNS (jusqu'√† 24h)</li>
                  <li>Relancez le provision une fois le DNS actif</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Erreur "KeyError: ContainerConfig" pendant le build Docker
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> Cache Docker corrompu (fr√©quent avec docker-compose 1.29.2).</p>
                <p><strong>Solution :</strong> Connectez-vous au serveur en SSH et ex√©cutez :</p>
                <div class="code-block">cd /opt/geoclic/deploy
sudo docker-compose down
sudo docker container prune -f
sudo docker-compose up -d --build<button class="copy-btn" onclick="copyCode(this)">Copier</button></div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Le site affiche "502 Bad Gateway"
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> Nginx fonctionne mais l'API ou le frontend ne r√©pond pas.</p>
                <p><strong>Solution :</strong></p>
                <ol style="margin: 8px 0 0 20px;">
                  <li>V√©rifiez les logs : <code>geoclic-fleet.sh logs NOM --service api</code></li>
                  <li>Si l'API a plant√©, red√©marrez via SSH : <code>sudo docker-compose restart api</code></li>
                  <li>Si le probl√®me persiste, red√©marrez tout : <code>sudo docker-compose down && sudo docker-compose up -d</code></li>
                </ol>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              L'init √©choue sur une migration SQL
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> Une table ou extension manquante, ou migration d√©j√† appliqu√©e.</p>
                <p><strong>Solution :</strong></p>
                <ol style="margin: 8px 0 0 20px;">
                  <li>Notez le num√©ro de la migration qui √©choue dans la sortie</li>
                  <li>Connectez-vous en SSH au serveur client</li>
                  <li>Examinez l'erreur : <code>sudo docker exec -i geoclic_db psql -U geoclic -d geoclic_db < /opt/geoclic/database/migrations/NNN_fichier.sql</code></li>
                  <li>Si "already exists", c'est OK ‚Äî la migration est d√©j√† pass√©e</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Comment supprimer compl√®tement un serveur client ?
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Attention :</strong> Cette action est irr√©versible !</p>
                <ol style="margin: 8px 0 0 20px;">
                  <li>Faire un backup d'abord : <code>geoclic-fleet.sh backup --client NOM</code></li>
                  <li>Se connecter : <code>geoclic-fleet.sh ssh NOM</code></li>
                  <li>Arr√™ter : <code>cd /opt/geoclic/deploy && sudo docker-compose down -v</code></li>
                  <li>Supprimer : <code>sudo rm -rf /opt/geoclic</code></li>
                  <li>Quitter : <code>exit</code></li>
                  <li>Retirer du registre : <code>geoclic-fleet.sh remove --name NOM</code></li>
                  <li>Supprimer le VPS chez l'h√©bergeur</li>
                  <li>Supprimer l'enregistrement DNS</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Les utilisateurs voient l'ancienne version apr√®s une mise √† jour
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <p><strong>Cause :</strong> Le cache du navigateur ou du Service Worker garde l'ancienne version.</p>
                <p><strong>Solution pour les utilisateurs :</strong></p>
                <ul style="margin: 8px 0 0 20px;">
                  <li>Ouvrir DevTools (F12) ‚Üí Application ‚Üí Stockage ‚Üí "Effacer les donn√©es du site"</li>
                  <li>Ou ouvrir en navigation priv√©e (Ctrl+Shift+N)</li>
                  <li>Ou vider le cache (Ctrl+Shift+Suppr)</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              Combien de temps prend chaque op√©ration ?
              <span class="arrow">‚ñ∂</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-content">
                <table>
                  <tr><th>Op√©ration</th><th>Dur√©e estim√©e</th></tr>
                  <tr><td>provision (premi√®re installation)</td><td>10-20 minutes</td></tr>
                  <tr><td>init (migrations + admin)</td><td>1-3 minutes</td></tr>
                  <tr><td>update (mise √† jour code)</td><td>5-10 minutes</td></tr>
                  <tr><td>backup</td><td>< 1 minute</td></tr>
                  <tr><td>status</td><td>< 30 secondes</td></tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê GLOSSAIRE ‚ïê‚ïê‚ïê -->
    <div class="section" id="sec-glossaire">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background: #f3e8ff; color: #7c3aed;">üìö</div>
          <div>
            <h3>Glossaire</h3>
            <p>D√©finition des termes techniques utilis√©s dans ce guide</p>
          </div>
        </div>

        <table>
          <thead>
            <tr><th style="width:180px;">Terme</th><th>D√©finition simple</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>VPS</strong></td>
              <td>Virtual Private Server. Un ordinateur distant lou√© chez un h√©bergeur, accessible 24h/24 via internet.</td>
            </tr>
            <tr>
              <td><strong>SSH</strong></td>
              <td>Secure Shell. Un moyen s√©curis√© de se connecter √† un ordinateur distant pour y taper des commandes.</td>
            </tr>
            <tr>
              <td><strong>DNS</strong></td>
              <td>Domain Name System. L'annuaire d'internet qui traduit les noms (lyon.geoclic.fr) en adresses IP (51.210.42.100).</td>
            </tr>
            <tr>
              <td><strong>SSL / HTTPS</strong></td>
              <td>Le cadenas vert dans le navigateur. Chiffre les communications entre le navigateur et le serveur.</td>
            </tr>
            <tr>
              <td><strong>Docker</strong></td>
              <td>Logiciel qui empaqu√®te les applications dans des "conteneurs" isol√©s. Chaque module G√©oClic tourne dans son propre conteneur.</td>
            </tr>
            <tr>
              <td><strong>Conteneur</strong></td>
              <td>Une bo√Æte isol√©e qui fait tourner une application. G√©oClic en utilise ~10 (API, DB, portail, etc.).</td>
            </tr>
            <tr>
              <td><strong>Migration SQL</strong></td>
              <td>Un fichier qui modifie la structure de la base de donn√©es (ajoute des tables, colonnes, etc.). G√©oClic en a 25.</td>
            </tr>
            <tr>
              <td><strong>rsync</strong></td>
              <td>Outil qui copie des fichiers entre deux serveurs en ne transf√©rant que ce qui a chang√© (rapide et efficace).</td>
            </tr>
            <tr>
              <td><strong>Cl√© SSH</strong></td>
              <td>Paire de fichiers (priv√© + public) qui remplace le mot de passe pour se connecter √† un serveur. Plus s√©curis√©.</td>
            </tr>
            <tr>
              <td><strong>Let's Encrypt</strong></td>
              <td>Service gratuit qui fournit des certificats SSL (HTTPS). Se renouvelle automatiquement tous les 3 mois.</td>
            </tr>
            <tr>
              <td><strong>Provision</strong></td>
              <td>Action de pr√©parer un serveur vierge pour qu'il soit pr√™t √† utiliser (installation de tout ce qu'il faut).</td>
            </tr>
            <tr>
              <td><strong>Super admin</strong></td>
              <td>Le compte utilisateur principal qui a tous les droits sur toutes les applications G√©oClic.</td>
            </tr>
            <tr>
              <td><strong>Branding</strong></td>
              <td>Personnalisation visuelle (logo, couleurs, nom) pour chaque collectivit√© cliente.</td>
            </tr>
            <tr>
              <td><strong>Onboarding</strong></td>
              <td>Le wizard (assistant) qui guide le client lors de sa premi√®re connexion pour configurer ses cat√©gories, services et emails.</td>
            </tr>
            <tr>
              <td><strong>PWA</strong></td>
              <td>Progressive Web App. Application web qui peut s'installer sur mobile comme une app native (sans passer par l'App Store).</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

  const section = document.getElementById('sec-' + id);
  const link = document.querySelector(`.nav-link[data-section="${id}"]`);

  if (section) section.classList.add('active');
  if (link) link.classList.add('active');

  // Update topbar title
  const titles = {
    accueil: 'Vue d\'ensemble',
    prerequis: 'Avant de commencer',
    vps: 'Acheter un VPS',
    dns: 'Configurer le DNS',
    ssh: 'Configurer SSH',
    provision: 'Provisionner un serveur',
    init: 'Initialiser la base de donn√©es',
    update: 'Mettre √† jour',
    status: '√âtat des serveurs',
    backup: 'Sauvegardes',
    logs: 'Consulter les logs',
    list: 'G√©rer les serveurs',
    'ssh-cmd': 'Acc√®s SSH distant',
    reference: 'R√©f√©rence des commandes',
    faq: 'FAQ et D√©pannage',
    glossaire: 'Glossaire'
  };
  document.getElementById('topbarTitle').textContent = titles[id] || id;

  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');

  // Scroll to top
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚îÄ‚îÄ‚îÄ Copy code ‚îÄ‚îÄ‚îÄ
function copyCode(btn) {
  const block = btn.parentElement;
  const code = block.textContent.replace('Copier', '').replace('Copi√© !', '').trim();
  navigator.clipboard.writeText(code).then(() => {
    btn.textContent = 'Copi√© !';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'Copier';
      btn.classList.remove('copied');
    }, 2000);
  });
}

// ‚îÄ‚îÄ‚îÄ Accordion ‚îÄ‚îÄ‚îÄ
function toggleAccordion(header) {
  const item = header.parentElement;
  item.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ Mobile sidebar ‚îÄ‚îÄ‚îÄ
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ Search ‚îÄ‚îÄ‚îÄ
function filterSections(query) {
  query = query.toLowerCase().trim();
  const links = document.querySelectorAll('.nav-link');

  if (!query) {
    links.forEach(l => l.style.display = '');
    document.querySelectorAll('.nav-section').forEach(s => s.style.display = '');
    return;
  }

  links.forEach(link => {
    const text = link.textContent.toLowerCase();
    const sectionId = link.getAttribute('data-section');
    const section = document.getElementById('sec-' + sectionId);
    const sectionText = section ? section.textContent.toLowerCase() : '';

    if (text.includes(query) || sectionText.includes(query)) {
      link.style.display = '';
    } else {
      link.style.display = 'none';
    }
  });
}

// ‚îÄ‚îÄ‚îÄ Keyboard shortcut ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
    e.preventDefault();
    document.getElementById('searchInput').focus();
  }
});
</script>

</body>
</html>
